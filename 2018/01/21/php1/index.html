<!DOCTYPE html><html lang="zh-CN"><head><meta http-equiv="content-type" content="text/html; charset=utf-8"><meta content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" name="viewport"><meta content="yes" name="apple-mobile-web-app-capable"><meta content="black-translucent" name="apple-mobile-web-app-status-bar-style"><meta content="telephone=no" name="format-detection"><meta name="description" content="卑鄙是卑鄙者的通行证，高尚是高尚者的墓志铭。 Despicability is the passport for the despicable, Dignity is the epitaph for the dignified."><title>浅读php核心配置 | Gray kite</title><link rel="stylesheet" type="text/css" href="/css/style.css?v=0.0.0"><link rel="stylesheet" type="text/css" href="//cdn.bootcss.com/normalize/7.0.0/normalize.min.css"><link rel="stylesheet" type="text/css" href="//cdn.bootcss.com/pure/1.0.0/pure-min.css"><link rel="stylesheet" type="text/css" href="//cdn.bootcss.com/pure/1.0.0/grids-responsive-min.css"><link rel="stylesheet" href="//cdn.bootcss.com/font-awesome/4.7.0/css/font-awesome.min.css"><script type="text/javascript" src="//cdn.bootcss.com/jquery/3.2.1/jquery.min.js"></script><link rel="Shortcut Icon" type="image/x-icon" href="/favicon.ico"><link rel="apple-touch-icon" href="/apple-touch-icon.png"><link rel="apple-touch-icon-precomposed" href="/apple-touch-icon.png"></head><body><div class="body_container"><div id="header"><div class="site-name"><h1 class="hidden">浅读php核心配置</h1><a id="logo" href="/.">Gray kite</a><p class="description"></p></div><div id="nav-menu"><a class="current" href="/."><i class="fa fa-home"> 首页</i></a><a href="/archives/"><i class="fa fa-archive"> 归档</i></a><a href="/history/"><i class="fa fa-history"> 历史</i></a><a href="/about/"><i class="fa fa-user"> 关于</i></a></div></div><div class="pure-g" id="layout"><div class="pure-u-1 pure-u-md-3-4"><div class="content_container"><div class="post"><h1 class="post-title">浅读php核心配置</h1><div class="post-meta">Jan 21, 2018<span> | </span><span class="category"><a href="/categories/代码审计/">代码审计</a></span></div><div class="post-content"><p>PHP配置文件指令很多，这里就对一些会影响PHP脚本安全的核心配置进行简要学习与记录。<br><a id="more"></a></p>
<h3 id="0X1-register-globals-全局变量注册开关"><a href="#0X1-register-globals-全局变量注册开关" class="headerlink" title="0X1 register_globals(全局变量注册开关)"></a>0X1 register_globals(全局变量注册开关)</h3><figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&gt;状态为on时，会将用户提交的参数注册成为全局变量并初始化值为参数对应的值。</span><br><span class="line">&gt;PHP版本小于4.2.3时设置为PHP<span class="emphasis">_INI_</span>ALL。</span><br><span class="line">&gt;在PHP 5.4.0移除了该选项。</span><br></pre></td></tr></table></figure>
<p>设置为on且PHP版本小于5.4.0时，测试如下：<br><img src="http://or8bkwor7.bkt.clouddn.com/register_globals.png" alt="enter description here"></p>
<h3 id="0X2-allow-url-include-是否允许包含远程文件"><a href="#0X2-allow-url-include-是否允许包含远程文件" class="headerlink" title="0X2 allow_url_include(是否允许包含远程文件)"></a>0X2 allow_url_include(是否允许包含远程文件)</h3><figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">&gt;状态为on时，可直接包含远程文件，当存在include($var)且$var可控的情况下，通过$var可执行PHP代码。</span><br><span class="line">&gt;在PHP 5.2.0后默认为off，范围是PHP<span class="emphasis">_INI_</span>ALL。</span><br></pre></td></tr></table></figure>
<p>设置为on时，测试如下：(教训：每次修改配置后要重启一次服务)<br><img src="http://or8bkwor7.bkt.clouddn.com/allow_url_include.png" alt="enter description here"></p>
<h3 id="0X3-magic-quotes-gpc-魔术引号自动过滤"><a href="#0X3-magic-quotes-gpc-魔术引号自动过滤" class="headerlink" title="0X3 magic_quotes_gpc(魔术引号自动过滤)"></a>0X3 magic_quotes_gpc(魔术引号自动过滤)</h3><figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&gt;状态为on时，会自动在GET，POST，COOKIE变量中的单引号，双引号，反斜杠，空字符(NULL)的前面加上反斜杠。</span><br><span class="line">&gt;在PHP 5中不会过滤$_SERVER变量。</span><br><span class="line">&gt;在PHP 5.4中被取消。</span><br><span class="line">&gt;PHP版本小于4.2.3，配置范围是PHP<span class="emphasis">_INI_</span>ALL。</span><br><span class="line">&gt;PHP版本大于4.2.3，配置范围是PHP<span class="emphasis">_INI_</span>PERDIR。</span><br></pre></td></tr></table></figure>
<p>测试如下：<br><img src="http://or8bkwor7.bkt.clouddn.com/magic_quotes_gpc.png" alt="enter description here"></p>
<h3 id="0X4-magic-quotes-runtime-魔术引号自动过滤"><a href="#0X4-magic-quotes-runtime-魔术引号自动过滤" class="headerlink" title="0X4 magic_quotes_runtime(魔术引号自动过滤)"></a>0X4 magic_quotes_runtime(魔术引号自动过滤)</h3><figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">&gt;数据库或文件中获取的数据对单引号，双引号，反斜杠，空字符(NULL)的前面加上反斜杠。</span><br><span class="line">&gt;在PHP 5.4中被取消，配置范围是PHP<span class="emphasis">_INI_</span>ALL。</span><br></pre></td></tr></table></figure>
<p>测试如下：<br><img src="http://or8bkwor7.bkt.clouddn.com/magic_quotes_runtime.png" alt="enter description here"><br>ini_set 为一个配置选项设置值</p>
<h3 id="0X5-magic-quotes-sybase-魔术引号自动过滤"><a href="#0X5-magic-quotes-sybase-魔术引号自动过滤" class="headerlink" title="0X5 magic_quotes_sybase(魔术引号自动过滤)"></a>0X5 magic_quotes_sybase(魔术引号自动过滤)</h3><figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&gt;转义空字符和把单引号变成双引号。</span><br><span class="line">&gt;作用对象与magic<span class="emphasis">_quotes_</span>gpc作用对象一致。</span><br><span class="line">&gt;设置为on时，会覆盖magic<span class="emphasis">_quotes_</span>gpc的配置，能无视magic<span class="emphasis">_quotes_</span>gpc的on。</span><br><span class="line">&gt;在PHP 5.4中被取消，配置范围是PHP<span class="emphasis">_INI_</span>ALL。</span><br></pre></td></tr></table></figure>
<p>测试如下：<br><img src="http://or8bkwor7.bkt.clouddn.com/magic_quotes_sybase.png" alt="enter description here"></p>
<h3 id="0X6-safe-mode-安全模式"><a href="#0X6-safe-mode-安全模式" class="headerlink" title="0X6 safe_mode(安全模式)"></a>0X6 safe_mode(安全模式)</h3><figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&gt;安全模式是PHP内嵌的一种安全机制，配置范围是PHP<span class="emphasis">_INI_</span>SYSTEM，在PHP 5.4中被取消。</span><br><span class="line">&gt;&gt;1)所有文件操作函数会受到限制(unlink() file() include())。</span><br><span class="line">&gt;&gt;1)通过函数popen() system() exec()等函数执行命令或程序时会提示错误。</span><br></pre></td></tr></table></figure>
<h3 id="0X7-open-basedir-PHP-可访问目录"><a href="#0X7-open-basedir-PHP-可访问目录" class="headerlink" title="0X7 open_basedir(PHP 可访问目录)"></a>0X7 open_basedir(PHP 可访问目录)</h3><figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">&gt;目录访问限制，将访问仅限制在指定的目录内，用斜线结束路径名，因为限制实际上针对的是目录名的前缀。</span><br><span class="line">&gt;在版本小于5.2.3时，配置范围时PHP<span class="emphasis">_INI_</span>SYSTEM，大于5.2.3时是PHP<span class="emphasis">_INI_</span>ALL。</span><br></pre></td></tr></table></figure>
<h3 id="0X8-disable-functions-禁用函数"><a href="#0X8-disable-functions-禁用函数" class="headerlink" title="0X8 disable_functions(禁用函数)"></a>0X8 disable_functions(禁用函数)</h3><figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&gt;要禁止一些危险函数时，应把dl()函数也添加刀禁止列表。</span><br><span class="line">&gt;配置禁用函数时以逗号分割。</span><br><span class="line">&gt;配置范围：php.ini only。</span><br></pre></td></tr></table></figure>
<h3 id="0X9-display-errors-error-reporting-错误显示"><a href="#0X9-display-errors-error-reporting-错误显示" class="headerlink" title="0X9 display_errors,error_reporting(错误显示)"></a>0X9 display_errors,error_reporting(错误显示)</h3><figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&gt;display_errors显示php脚本内部错误，生产环境中建议关闭。</span><br><span class="line">&gt;error_reporting配置错误显示级别。</span><br><span class="line">&gt;配置范围：PHP<span class="emphasis">_INI_</span>ALL。</span><br></pre></td></tr></table></figure></div><script type="text/javascript" src="/js/share.js?v=0.0.0" async></script><a class="article-share-link" data-url="http://yoursite.com/2018/01/21/php1/" data-id="cjcxnosk600020kvjsexfuu8m" data-qrcode="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAK4AAACuCAAAAACKZ2kyAAAB0UlEQVR42u3aS46DQAwFwNz/0hlpViNlIM92dyeLYoUiAgULy7/HIz6ev8ff89df7q+8v8PiAxcXd8x93h6viJx49ZTkxS5fCRcX9yC3F7yqvyT0NzZcXNwv4+bX3EN798fFxf1Obi8NWvU5cHFxz3MTypuypHW3jbUaLi7ugNtrmK49397fxcXFXTSVmIetPAGK7oOLi3uEm4xJ5slQPoyJwhwuLu5mbpJk5MsWvYZI8lFwcXFPcvMHVEuaSZiLAisuLu42bq9JWi1XeoHvMu7i4uJu5vZSmfKt4ySmMKbFxcXdzM1LkXzpqjeqKZQ9uLi4m7mFZkRcqFTD3IKBKy4u7iLufUjqDVnztCl/vX/aIri4uNu4+ei0l5RUXxgXF/cbuNUha3WkmrRaCmUVLi7uEW61TqquU1S50YfAxcXdzJ0PUMsTm8G6Bi4u7kluvnqVs+aDWFxc3M9yVy1a5WVSdXgT9W9wcXEXcasBJXlwMojNh7WjiTEuLu6AWw1ekx5MEsjeBDhcXNyD3F46kjc4ehG00N/FxcX9ELeaDOXrXFsCGS4u7nFuvpI1SW5wcXE/y60Gl+q/Jq2QZlsEFxd3wJ2sZE0WsPLrcXFxD3J/AJk3/DNCNZvPAAAAAElFTkSuQmCC">分享</a><div class="tags"><a href="/tags/代码审计/">代码审计</a><a href="/tags/PHP/">PHP</a><a href="/tags/配置/">配置</a></div><div class="post-nav"><a class="pre" href="/2018/01/28/2/">SQL Injection小结</a></div></div></div></div><div class="pure-u-1-4 hidden_mid_and_down"><div id="sidebar"><div class="widget"><form class="search-form" action="//www.google.com/search" method="get" accept-charset="utf-8" target="_blank"><input type="text" name="q" maxlength="20" placeholder="Search"/><input type="hidden" name="sitesearch" value="http://yoursite.com"/></form></div><div class="widget"><div class="widget-title"><i class="fa fa-folder-o"> 分类</i></div><ul class="category-list"><li class="category-list-item"><a class="category-list-link" href="/categories/代码审计/">代码审计</a><span class="category-list-count">2</span><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/代码审计/漏洞挖掘/">漏洞挖掘</a><span class="category-list-count">1</span></li></ul></li></ul></div><div class="widget"><div class="widget-title"><i class="fa fa-star-o"> 标签</i></div><div class="tagcloud"><a href="/tags/代码审计/" style="font-size: 15px;">代码审计</a> <a href="/tags/PHP/" style="font-size: 15px;">PHP</a> <a href="/tags/SQL注入/" style="font-size: 15px;">SQL注入</a> <a href="/tags/配置/" style="font-size: 15px;">配置</a></div></div><div class="widget"><div class="widget-title"><i class="fa fa-file-o"> 最近文章</i></div><ul class="post-list"><li class="post-list-item"><a class="post-list-link" href="/2018/01/28/2/">SQL Injection小结</a></li><li class="post-list-item"><a class="post-list-link" href="/2018/01/21/php1/">浅读php核心配置</a></li></ul></div><div class="widget"><div class="widget-title"><i class="fa fa-external-link"> 友情链接</i></div><ul></ul><a href="https://www.jianshu.com/u/a86881cc470a" title="沉潜3070" target="_blank">沉潜3070</a></div></div></div><div class="pure-u-1 pure-u-md-3-4"><div id="footer">Copyright © 2018 <a href="/." rel="nofollow">Gray kite.</a> Powered by<a rel="nofollow" target="_blank" href="https://hexo.io"> Hexo.</a><a rel="nofollow" target="_blank" href="https://github.com/tufu9441/maupassant-hexo"> Theme</a> by<a rel="nofollow" target="_blank" href="https://github.com/pagecho"> Cho.</a></div></div></div><a class="show" id="rocket" href="#top"></a><script type="text/javascript" src="/js/totop.js?v=0.0.0" async></script><script type="text/javascript" src="//cdn.bootcss.com/fancybox/3.2.5/jquery.fancybox.min.js" async></script><script type="text/javascript" src="/js/fancybox.js?v=0.0.0" async></script><link rel="stylesheet" type="text/css" href="//cdn.bootcss.com/fancybox/3.2.5/jquery.fancybox.min.css"><script type="text/javascript" src="/js/codeblock-resizer.js?v=0.0.0"></script><script type="text/javascript" src="/js/smartresize.js?v=0.0.0"></script></div></body></html>